<html>

<head>
  <title>JSConnect4</title>
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
  <script src="bower_components/buzz/dist/buzz.min.js"></script>
  <script src="jsconnect4.min.js"></script>
  <script src="js/mathUtils.js"></script>
  <script src="js/gameboard.js"></script>
  <link rel="stylesheet" type="text/css" href="css/styles.css"></link>

  <script>
    const BASE_URL = "http://connect4ii-fdloch.rhcloud.com/";
    var gameLog = [];

    $(function() {
      $.ajax({
        url: BASE_URL + "newGame",
        success: function(data) {
          var uuid = data.uuid;
          console.log("UUID: " + uuid);

          new Gameboard("#board", function(sPlayerTurn, fnCallback) {
            var turn = {};

            turn.player = sPlayerTurn;

            $.ajax({
              url: BASE_URL + "/doTurn",
              success: function(data) {
                var isRemi = data.is_remi || false;
                var isPlayerWinner = data.is_won_by_player || false;
                var isAIWinner = data.is_won_by_ai || false;
                var aiTurn = data.ai_turn || "";


                turn.ai = aiTurn;
                turn.isRemi = isRemi;
                turn.isPlayerWinner = isPlayerWinner;
                turn.isAIWinner = isAIWinner;

                gameLog.push(turn);

                fnCallback(new TurnSummary(isAIWinner, isPlayerWinner, isRemi, aiTurn));
              },
              data: JSON.stringify({
                uuid: uuid,
                player_turn: sPlayerTurn
              }),
              type: "POST"
            });
          });
        },
        data: JSON.stringify({
          player_begins: true,
          ai: "easyai_norandom" //Play without random for testing purposes
        }),
        type: "POST"
      });
    });

    function showLog() {
      window.prompt("Please copy via STRG+C / CMD+C", JSON.stringify(gameLog));
    }

    function showMinimizedLog() {
      var output = "";
      for (var i = 0; i < gameLog.length; i++) {
        output += gameLog[i].player + ";" + gameLog[i].ai;
        if (i + 1 < gameLog.length) output += "$";
      }

      window.prompt("Please copy via STRG+C / CMD+C", output);
    }
  </script>
</head>

<body>
  <div id="board" class="jsConnect4Board"></div>
  <button onClick="showMinimizedLog();">Show log</button>
</body>

</html>
